<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('Catálogo')}"></head>
<body>
<div th:replace="~{layout :: header}"></div>

<main class="container">
  <div class="catalog-layout">
    <!-- Barra Lateral de Filtros -->
    <aside class="filters-sidebar">
      <h3>Categorías</h3>
      <ul>
        <li><a th:href="@{/catalogo}">Todas</a></li>
        <li th:each="categoria : ${categorias}">
          <a th:href="@{/catalogo(categoria=${categoria.id})}" th:text="${categoria.nombre}">Nombre Categoría</a>
        </li>
      </ul>
    </aside>

    <!-- Contenido Principal de Productos -->
    <div class="main-content">
      <h1 style="font-size: 2.5rem; font-weight: 700; color: var(--heading-color);" th:text="${titulo}">Nuestros Productos</h1>

      <div th:if="${productos.isEmpty()}" style="text-align: center; padding: 4rem 0;">
        <p>No se encontraron productos que coincidan con tu búsqueda o filtro.</p>
      </div>

      <div class="product-grid" th:unless="${productos.isEmpty()}">
        <div class="product-card" th:each="product : ${productos}">
          <div class="product-image-container">
            <a th:href="@{/productos/{id}(id=${product.id})}">
              <img th:src="${product.imagenUrl}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/e2e8f0/334155?text=Producto';" alt="Imagen del producto">
            </a>
            <div th:if="${product.stock == 0}" class="out-of-stock-badge">Agotado</div>
          </div>
          <div class="product-card-body">
            <h3>
              <a th:href="@{/productos/{id}(id=${product.id})}" th:text="${product.nombre}" style="text-decoration: none; color: inherit;">Nombre del Producto</a>
            </h3>
            <p class="price" th:text="'S/ ' + ${#numbers.formatDecimal(product.precio, 1, 'COMMA', 2, 'POINT')}">S/ 99.90</p>

            <!-- --- LÍNEA CORREGIDA PARA MOSTRAR STOCK --- -->
            <p class="card-stock" th:if="${product.stock > 0}" th:text="'Stock disponible: ' + ${product.stock}"></p>

            <div th:if="${product.stock > 0}">
              <a th:href="@{/carrito/agregar/{id}(id=${product.id})}" class="btn btn-primary" style="width: 100%;">Añadir al carrito</a>
            </div>
            <div th:if="${product.stock == 0}">
              <button class="btn btn-disabled" style="width: 100%;" disabled>Agotado</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<div th:replace="~{layout :: footer}"></div>
</body>
</html>
